Function Get-NexposeVulnerabilityCategory {
<#
    .SYNOPSIS
        Returns all vulnerabilities categories that can be assigned to a vulnerability.


    .DESCRIPTION
        Returns all vulnerabilities categories that can be assigned to a vulnerability. These categories group and label vulnerabilities by general purpose, affected systems, vendor, etc.  By default it will include the list of vulnerability Ids contained within the selected category.

    .PARAMETER Id
        The identifier of the category.

    .PARAMETER IncludeVulnerabilityDetail
        Include details of each vulnerability associated with the specific category.  This may take a long time to return results.

    .EXAMPLE
        Get-NexposeVulnerabilityCategory -Id 123

    .EXAMPLE
        Get-NexposeVulnerabilityCategory -Id 123 -IncludeVulnerabilityDetail

    .NOTES
        For additional information please see my GitHub wiki page

    .FUNCTIONALITY
        GET: vulnerability_categories
        GET: vulnerability_categories/{id}
        GET: vulnerability_categories/{id}/vulnerabilities

    .LINK
        https://github.com/My-Random-Thoughts/Rapid7Nexpose
#>

    [CmdletBinding()]
    Param (
        [string]$Id = 0,

        [switch]$IncludeVulnerabilityDetail
    )

    If ($Id -gt 0) {
        $vulnCat =  (Invoke-NexposeQuery -UrlFunction "vulnerability_categories/$Id" -RestMethod Get)
        $vulns   = @(Invoke-NexposeQuery -UrlFunction "vulnerability_categories/$Id/vulnerabilities" -RestMethod Get)
        $vulnCat | Add-Member -Name 'vulnerabilities' -Value $vulns -MemberType NoteProperty

        If ($IncludeVulnerabilityDetail.IsPresent) {
            $vulnCat.vulnerabilities = @()
            ForEach ($vuln In $vulns) {
                $vulnCat.vulnerabilities += (Get-NexposeVulnerabilityItem -Id $vuln)
            }
        }
        Write-Output $vulnCat
    }
    Else {
        Write-Output @(Invoke-NexposeQuery -UrlFunction 'vulnerability_categories' -RestMethod Get)    # Return All
    }
}
